#include <stdio.h>
#include <stdint.h>
#include <math.h>

static const uint32_t mult_table[16] = { 1, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 20, 24, 24, 30, 30 };
static const uint32_t ksl_table[16] = { 0, 144, 192, 222, 240, 258, 270, 282, 288, 300, 306, 312, 318, 324, 330, 336 };
static uint32_t attack_table1[76];
static uint32_t attack_table2[76];
static uint32_t decrel_table1[76];
static uint32_t decrel_table2[76];

static const double attack_time2[64] =
{
    0.00, 0.00, 0.00, 0.00,
    0.11, 0.11, 0.14, 0.19,
    0.22, 0.26, 0.31, 0.37,
    0.43, 0.49, 0.61, 0.73,
    0.85, 0.97, 1.13, 1.45,
    1.70, 1.94, 2.26, 2.90,
    3.39, 3.87, 4.51, 5.79,
    6.78, 7.74, 9.02, 11.58,
    13.57, 15.49, 18.05, 23.17,
    27.14, 30.98, 36.10, 46.34,
    54.27, 61.95, 72.19, 92.67,
    108.54, 123.90, 144.38, 185.34,
    217.09, 247.81, 288.77, 370.69,
    434.18, 495.62, 577.54, 741.38,
    868.35, 991.23, 1155.07, 1482.75,
    800000.00, 800000.00, 800000.00, 800000.00
};

static const double attack_time1[64] =
{
    0.00, 0.00, 0.00, 0.00,
    0.20, 0.24, 0.30, 0.38,
    0.42, 0.46, 0.56, 0.70,
    0.80, 0.92, 1.12, 1.40,
    1.56, 1.84, 2.20, 2.76,
    3.12, 3.68, 4.40, 5.52,
    6.24, 7.36, 8.80, 11.04,
    12.48, 14.72, 17.60, 22.08,
    24.96, 29.44, 35.20, 44.16,
    49.92, 58.88, 70.40, 88.32,
    99.84, 117.76, 140.80, 176.76,
    199.68, 235.52, 281.60, 353.28,
    399.36, 471.04, 563.20, 706.56,
    798.72, 942.08, 1126.40, 1413.12,
    1597.44, 1884.16, 2252.80, 2826.24,
    800000.00, 800000.00, 800000.00, 800000.00
};

static const double decrel_time2[64] =
{
    0.51, 0.51, 0.51, 0.51,
    0.58, 0.69, 0.81, 1.01,
    1.15, 1.35, 1.62, 2.02,
    2.32, 2.68, 3.22, 4.02,
    4.62, 5.38, 6.42, 8.02,
    9.24, 10.76, 12.84, 16.04,
    18.48, 21.52, 25.68, 32.08,
    36.96, 43.04, 51.36, 64.16,
    73.92, 86.08, 102.72, 128.32,
    147.84, 172.16, 205.44, 256.64,
    295.68, 344.34, 410.88, 513.28,
    591.36, 688.64, 821.76, 1026.56,
    1182.72, 1377.28, 1643.52, 2053.12,
    2365.44, 2754.56, 3287.04, 4106.24,
    4730.88, 5509.12, 6574.08, 8212.48,
    800000.00, 800000.00, 800000.00, 800000.00
};

static const double decrel_time1[64] =
{
    2.40, 2.40, 2.40, 2.40,
    2.74, 3.20, 3.84, 4.80,
    5.48, 6.40, 7.68, 9.60,
    10.96, 12.80, 15.36, 19.20,
    21.92, 25.56, 30.68, 38.36,
    43.84, 51.12, 61.36, 76.72,
    87.68, 102.24, 122.72, 153.44,
    175.36, 204.48, 245.44, 306.88,
    350.72, 488.96, 490.88, 613.76,
    701.44, 817.92, 981.76, 1227.52,
    1402.88, 1635.84, 1963.52, 2455.04,
    2805.76, 3271.68, 3927.04, 4910.08,
    5611.52, 6543.36, 7854.08, 9820.16,
    11223.04, 13086.72, 15708.16, 19640.32,
    22446.08, 26173.44, 31416.32, 39280.64,
    800000.00, 800000.00, 800000.00, 800000.00
};

static uint32_t eg_table[256];

static void init_egtables()
{
    int i;

    for(i = 0; i < 64; i++)
    {
        decrel_table2[i] = (uint32_t)(ceil(decrel_time2[63 - i] * 1000.0 / 90.70294784580499));
        decrel_table1[i] = (uint32_t)(ceil(decrel_time1[63 - i] * 1000.0 / 90.70294784580499));
        attack_table2[i] = (uint32_t)(ceil(attack_time2[63 - i] * 1000.0 / 90.70294784580499));
        attack_table1[i] = (uint32_t)(ceil(attack_time1[63 - i] * 1000.0 / 90.70294784580499));
    }

    for(i = 64; i < 76; i++)
    {
        decrel_table2[i] = decrel_table2[63];
        decrel_table1[i] = decrel_table1[63];
        attack_table2[i] = attack_table2[63];
        attack_table1[i] = attack_table1[63];
    }

    for(i = 0; i < 76; i++)
    {
        if(decrel_table2[i] == 0)
            decrel_table2[i] = 1;
        if(decrel_table1[i] == 0)
            decrel_table1[i] = 1;
        if(attack_table2[i] == 0)
            attack_table2[i] = 1;
        if(attack_table1[i] == 0)
            attack_table1[i] = 1;
    }

    for(i = 0; i < 256; i++)
        eg_table[i] = (uint32_t)(1.0 / pow(2.0, i / 6.0) * 16384.0 * 0.75);

}

void printTable(uint32_t *t, size_t size, const char *name)
{
    size_t i, l;
    printf("static const uint32_t %s[%lu] =\n{\n", name, (unsigned long)size);

    for(i = 0, l = 0; i < size; ++i)
    {
        if(l >= 70)
        {
            l = 0;
            printf("\n");
        }

        if(l == 0)
            l += printf("    ");
        else
            l += printf(" ");

        if(i < size - 1)
            l += printf("%u,", t[i]);
        else
            l += printf("%u", t[i]);
    }

    printf("\n};\n");
}

int main()
{
    init_egtables();
    printTable(attack_table1, 76, "attack_table1");
    printTable(attack_table2, 76, "attack_table2");
    printTable(decrel_table1, 76, "decrel_table1");
    printTable(decrel_table2, 76, "decrel_table2");
    printTable(eg_table, 256, "eg_table");

    return 0;
}
